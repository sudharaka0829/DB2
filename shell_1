#!/bin/sh

# Switch to the db2inst1 user and define functions
su - db2inst1 << 'EOF' | grep -v 'Last'
# DB2 connection details
DB_USER="your_db_username"
DB_PASS="your_db_password"
DB_NAME="pegadb"

# Function to execute DB2 queries
execute_db2_query() {
    db2 connect to $DB_NAME > /dev/null 2>&1
    db2 -x "$1"
}

# Function to get table usages
get_table_usages() {
    execute_db2_query "SELECT TBSP_USED_PAGES * 100.0 / TBSP_TOTAL_PAGES AS USED_PERCENTAGE FROM SYSIBMADM.TBSP_UTILIZATION" | grep -v 'Division' |  tr -d [:space:]
}


table_usages=$(get_table_usages | sed 's/^[[:space:]]*//')

echo "TableUsages:$table_usages"

EOF
